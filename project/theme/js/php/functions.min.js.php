<?php

/**
 * Simple JS minifier class
 * 
 * Minify assembled JS data
 *
 * @author Dinko Skopljak <ds@futura-web.de>
 **/

header('Content-type: text/javascript');

ob_start();

require_once('functions.js.php');
$output = ob_get_contents();

ob_end_flush();

$output = preg_replace('/false/', '!1', $output);
$output = preg_replace('/last_known_scroll_position/', 'lksp', $output);
$output = preg_replace('/true/', '!0', $output);
$output = preg_replace('/(?:(?:\/\*(?:[^*]|(?:\*+[^*\/]))*\*+\/)|(?:(?<!\:|\\\)\/\/[^"\'].*))/', '', $output);
$output = preg_replace('/ = /', '= ', $output);
$output = preg_replace('/\s*\n\s*/', '', $output);
$output = preg_replace('/([^A-Za-z0-9\_\$])\h/', '$1', $output);
$output = preg_replace('/\s?([\(\[{])\s?/', '$1', $output);
$output = preg_replace('/\s([\)\]}])/', '$1', $output);
$output = preg_replace('/;\n/', ';', $output);
$output = preg_replace('/;}/', '}', $output);
$output = preg_replace('/}\n/', '}', $output);

$fileJS = fopen('../functions.min.js', 'w') or die('Unable to open file!');
$functionsJS = $output;
fwrite($fileJS, $functionsJS);
fclose($fileJS);
